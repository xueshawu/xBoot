/*
*********************************************************************************************************
*                                            INCLUDE FILES
*********************************************************************************************************
*/
#include "Bsp_Watchdog.h"
#include "stm32f10x_rcc.h"
#include "stm32f10x_wwdg.h"

/*
*********************************************************************************************************
*                                            LOCAL DEFINES
*********************************************************************************************************
*/
#define WWDG_CNT			0x7FU
#define WWDG_Windows		0x50U



/*
*********************************************************************************************************
*                                            LOCAL TABLES
*********************************************************************************************************
*/
/*
*********************************************************************************************************
*                                       LOCAL GLOBAL VARIABLES
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                                      LOCAL FUNCTION PROTOTYPES
*********************************************************************************************************
*/

void Bsp_Watchdog_Init(void)
{
	WWDG_DeInit();
	RCC_APB1PeriphClockCmd(RCC_APB1Periph_WWDG, ENABLE);

	/* On other devices, WWDG clock counter = (PCLK1(36MHz)/4096)/8 = 1099 Hz (~910 us)  */
	WWDG_SetPrescaler(WWDG_Prescaler_8);
	
	/* Set Window value to 80; WWDG counter should be refreshed only when the counter
	 is below 80 (and greater than 64) otherwise a reset will be generated */
	WWDG_SetWindowValue(WWDG_Windows);
	
	/*In this case the refresh window is: 
	 ~910 us * (127-80) = 42.77 ms < refresh window < ~910 us * 64 = 58.25ms */
	 
	WWDG_Enable(WWDG_CNT);
}


/* 50ms喂狗一次即可 */
void Bsp_Watchdog_Feed(void)
{
	WWDG_SetCounter(WWDG_CNT);
}













/*
*********************************************************************************************************
*                                        END OF THE FILE
*********************************************************************************************************
*/








